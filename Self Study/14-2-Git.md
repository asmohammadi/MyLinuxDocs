# Git

### Git Scenarios:
* `On Client`
  * Better for develop & test purpose
  * Need Remote Repo for Sync
* `On allocated Server (Git Server)`
  * Better for Enterprise & Teams
  * Integrate with CI/CD
  * Need maintenance & backup
  * Need more security
* `With Docker Container`
  * Better for DevOps Solutions
  * OS Isolation
  * Integration with ArgoCD, GitLabCI, Jenkins
  * Need maintenance
  * Complicated

### Types of Git:
* `Local Repository`
  * Everything is Local
  * No need to internet
* `GitHub`
  * An online Git service
  * Microsoft Git
  * CI/CD with GitHub Actions
  * Public or private projects
* `GitLab`
  * An online Git service
  * GitLab Inc
  * Two type : Cloud GitLab & Self-hosted GitLab
  * CI/CD with GitLab CI
  * Enterprise solution
* `Cloud Git Services`
  * GitHub، GitLab، Bitbucket، Azure DevOps
  * Remote Repository on Cloud
  * Good for Team work

### Type of Syncing:
* Local <-> GitHub
* Local <-> GitLab
* GitHub <-> GitLab : `Mirroring`
* Local Only

### CI/CD Tools:
* `SaaS Tools` : Online Tools
  * GitHub Actions (Online / Self-hosted)
  * GitLab CI/CD (Online / Self-hosted)
  * CircleCI (Fast, with simple YAML settings)
  * Travis CI
  * Buddy (For small teams with GUI)
* `Self-Hosted Tools` : On Server
  * Jenkins (Free, Enterprise solutions, Powerful with many Plugins)
  * TeamCity (Jetbrains)
  * Bamboo (Atlassian, Integrate with Bitbucket & Jira)
  * Drone CI (Based on container)
  * GoCD (Focus on complicated pipelines)
* `Cloud-Native` : For Docker & Kubernetes
  * ArgoCD (Continuous Deployment with GitOps)
  * FluxCD
  * Tekton (for Kubernetes)
  * Spinnaker (for Microservices, Complicated deployment)


### Installing Git:
```sh
apt install git -y
git --version
```

### Git Levels Configuration:
1. System-wide
2. Global (User)
3. Local (Local Repository)

```sh
# Priority:
Local > Global > System
```

### 1. System-wide:
* Using for System-wide & for all users on server
* Using in Enterprise & shared Servers
* Enforcing rules for all servers
* `Example` : Set default editor (Nano / Vim)
* `Example` : Set Proxy or Certificate

```sh
# Path:
/etc/gitconfig
# Display git configuration:
git config --system --list
```

### 2. Global (User):
* Using for current user
* `Example` : Setting UserName & Email
* `Example` : Set alias
* `Example` : Colorize results

```sh
# Path:
~/.gitconfig
# or
~/.config/git/config
# Display git configuration:
git config --global --list
```

### 3. Local:
* Using just for the specific Repository
* Using for Teamwork projects with high priority configurations
* Config file will save in the repository (under .git/)
* `Example` : Using work email & username for a specific project
* `Example` : Need to use specific repository

```sh
# Path:
.git/config
# Display git configuration:
git config --local --list
```
```sh
# Display which Level of Git configuration:
git config --list --show-origin
```

### Git Primary Configurations:
```sh
git config --global user.name "Asghar Mohammadi"
git config --global user.email "asgharmohammadi_am@yahoo.co.uk"
git config --global color.ui auto
git config --global core.editor nano
```
```sh
# Check configuration:
git config --list
```
```sh
# gitconfig:
[user]
    name = Asghar Mohammadi
    email = asgharmohammadi_am@yahoo.co.uk
[color]
    ui = auto
[core]
    editor = nano
```

### Create Local Repository:

#### Project Structure:
```sh
git-lab/
 ├── .git/ # Git local database
 ├── nginx.conf
 └── playbook.yml
```
```sh
mkdir git-lab/ # Create project directory
cd /git-lab/
git init # Make the directory a Repository
# A hidden directory .git will create including all history and data of the repository.
```
```sh
# Adding sample files to directory:
echo "server configuration v1" > nginx.conf
echo "- hosts: all" > playbook.yml
```
```sh
git status # Check the Repository
# It will show Untracked files before commit.
```
```sh
# Adding files to Stage:
git add .
# or
git add nginx.conf
git add playbook.yml
```
```sh
# Commit:
git commit -m "Initial commit: add nginx.conf and playbook.yml"
# Commit history:
git log
# It will show commit, author, date & message of the commit.
```
```sh
root@server:~/git-lab# git log

commit 4467fd483fe53a8ff67b520ede55b9f700332dc7 (HEAD -> master)
Author: Asghar Mohammadi <asgharmohammadi_am@yahoo.co.uk>
Date:   Sat Aug 16 14:59:41 2025 +0000

    Initial commit: add nginx.conf and playbook.yml
```

### Git Commands:
```sh
git status # Check git status
git diff # Display the changes
git add nginx.conf # Add changes to Stage
git commit -m "Update nginx.conf to version 2" # Add Commit
git log # Display the history of commits
git log --oneline # Display Summary
git diff HEAD~1 HEAD # Display differences between two commits
```

### Git Branch:
```sh
git branch # Display branches
git branch dev # Create new branch "dev"
git checkout dev # Switch to "dev" branch
git switch -c dev # Create & Switch to "dev" branch
git checkout main/master # Switch to Main/Master branch
git merge dev # Merge "dev" to "main" branch (Without conflict)
git branch -d dev # Delete "dev" branch
```

### Connecting Remote to Local Repository:
```sh
# Using Https:
git remote add origin https://github.com/username/ansible-lab.git
git remote add origin https://github.com/asmohammadi/ansible-lab.git
# Using Secure SSH:
git remote add origin git@github.com:username/ansible-lab.git
git remote add dev git@github.com:asmohammadi/dev-lab.git
```
```sh
git remote -v # Check connection
```
```sh
# Push changes to GitHub:
git branch -M main # Need to change the "master" branch to "main" for connecting to GitHub
git push -u origin main # Push to first branch First time
git push -u origin dev # Push to second branch First time
git push # Push second time
git branch -vv # Check branch upstreams
```

#### Two ways to secure connect to Remote Repository:
1. SSH Key
2. Token

#### 1. SSH Key:
> In this way need to create a SSH key and add it to Remote Repository.
```sh
# If have SSH key error:
ssh-keygen -t rsa -b 4096 -C "you@example.com" # Create new SSH key
ssh-keygen -t rsa -b 4096 -C "asgharmohammadi_am@yahoo.co.uk" 
cat ~/.ssh/id_rsa.pub
# or
cat ~/.ssh/id_ed25519.pub
# Add SSH key to GitHub:
GitHub > Settings > SSH Keys > Add Key
```

#### 2. Token:
> In this way need to generate a Token on Remote Repository and use it when connecting to Remote Repository.
```sh
GitHub > Settings > Developer settings > Personal access token > File-grained tokens > Create new token
```

### Clone:
```sh
# Download the repository on local system
# Https:
git clone https://github.com/username/ansible-lab.git
# SSH:
git clone git@github.com:username/ansible-lab.git
```

### Pull:
```sh
# Get the latest changes from repository & merge with local system
git pull origin main
```

### Push:
```sh
# Commit & Push the changes from local system to repository
git push origin main
git push -u origin main # Push first time & set upstream
```

### Real Repository Structure:
> Real Repository structure with Config files, Ansible playbooks & Scripts.
```sh
server-config/
 ├── nginx/
 │    ├── nginx.conf
 │    └── sites-available/
 │         └── app.conf
 ├── ansible/
 │    ├── inventory.ini
 │    ├── playbooks/
 │    │     ├── deploy.yml
 │    │     └── firewall.yml
 ├── scripts/
 │    ├── backup.sh
 │    └── monitoring.sh
 └── README.md
```




